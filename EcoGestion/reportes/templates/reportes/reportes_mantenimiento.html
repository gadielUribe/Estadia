{% extends 'base.html' %}
{% load static %}

{% block title %}Reporte de Mantenimiento{% endblock %}

{% block extra_css %}
  <link href="{% static 'css/list_view.css' %}" rel="stylesheet">
  <link href="{% static 'css/planta.css' %}" rel="stylesheet"> <link href="{% static 'css/report_view.css' %}" rel="stylesheet"> {% endblock %}


{% block content %}

<style>
.report-cards {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap: 12px;
  margin-bottom: 20px;
}
.report-card {
  background: #fff;
  border: 1px solid #e4e7ec;
  border-radius: 10px;
  padding: 16px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.03);
}
.report-card-title {
  font-size: 0.9rem;
  color: #6c757d;
  text-transform: uppercase;
  letter-spacing: .5px;
}
.report-card-value {
  font-size: 1.8rem;
  font-weight: 700;
  color: #2d9cdb;
}
.report-card-subtitle {
  font-size: 0.85rem;
  color: #555;
}
</style>

<div class="list-header">
  <h2>Reporte de mantenimiento</h2>
  
  <div class="export-actions">
    <a href="?{% if q %}q={{ q }}&{% endif %}{% if f_ini %}f_ini={{ f_ini }}&{% endif %}{% if f_fin %}f_fin={{ f_fin }}&{% endif %}excel=1"
       class="btn-secondary-pill" style="font-size: 0.85rem; padding: 8px 15px; border-color: #28a745; color: #28a745;">
       Excel
    </a>
    <a href="?{% if q %}q={{ q }}&{% endif %}{% if f_ini %}f_ini={{ f_ini }}&{% endif %}{% if f_fin %}f_fin={{ f_fin }}&{% endif %}pdf=1"
       class="btn-secondary-pill" style="font-size: 0.85rem; padding: 8px 15px; border-color: #dc3545; color: #dc3545;">
       PDF
    </a>
  </div>
</div>

<div class="filter-bar-wrapper">
  <form method="get" class="filter-bar-form">
    
    <div class="filter-group" style="flex-grow: 2;">
      <label>Buscar</label>
      <input type="text" name="q" value="{{ q }}" placeholder="Buscar (especie, observaciones)">
    </div>

    <div class="filter-group">
      <label>Desde</label>
      <input type="date" name="f_ini" value="{{ f_ini }}">
    </div>
    <div class="filter-group">
      <label>Hasta</label>
      <input type="date" name="f_fin" value="{{ f_fin }}">
    </div>

    <div class="filter-group filter-actions">
      <button class="btn-save" type="submit" style="background-color: #0d6efd; border:none;">Filtrar</button>
    </div>
  </form>
</div>

<p class="list-total-count">
  Total de tareas: <b>{{ total_tareas }}</b> |
  Realizadas: <b>{{ realizadas }}</b> |
  Cumplimiento global: <b>{{ cumplimiento_global }}%</b>
</p>

{% if tipos_stats %}
<div class="report-cards">
  {% for stat in tipos_stats %}
    <div class="report-card">
      <div class="report-card-title">{{ stat.tipo }}</div>
      <div class="report-card-value">{{ stat.porcentaje }}%</div>
      <div class="report-card-subtitle">
        Total: {{ stat.total }} | Realizadas: {{ stat.realizadas }} | Pendientes: {{ stat.pendientes }}
      </div>
    </div>
  {% endfor %}
</div>
{% endif %}

<div class="table-wrapper">
  <div class="table-responsive-wrapper">
    <table class="table">
      <thead>
        <tr>
          <th>Especie</th>
          <th>Tipo de tarea</th>
          <th>Fecha programada</th>
          <th>Fecha de ejecuci√≥n</th>
          <th>Estado</th>
          <th>Observaciones</th>
        </tr>
      </thead>
      <tbody>
        {% for t in tareas %}
        <tr>
          <td>{{ t.especie }}</td>
          <td>{{ t.tipo }}</td>
          <td>{{ t.fecha_programada }}</td>
          <td>{{ t.fecha_realizacion }}</td>
          <td>{{ t.estado }}</td>
          <td class="text-truncate" style="max-width: 300px;">{{ t.observaciones }}</td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="6" class="text-center p-4">No hay tareas que coincidan con los filtros.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
