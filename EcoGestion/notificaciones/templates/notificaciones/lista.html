{% extends "base.html" %}
{% load static %}

{% block title %}Notificaciones{% endblock %}

{% block extra_css %}
<link href="{% static 'css/list_view.css' %}" rel="stylesheet">
{% endblock %}


{% block content %}

<div class="list-header">
 <h2>Notificaciones</h2>
</div>

<div class="nav-container-pills">
   <ul class="nav notif-pills">
    <li class="nav-item">
      <a class="nav-link {% if filtro == 'todas' %}active{% endif %}"
      href="{% url 'notificaciones:lista' %}?f=todas">
      Todas <span class="badge text-bg-secondary">{{ total }}</span>
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link {% if filtro == 'no_leidas' %}active{% endif %}"
      href="{% url 'notificaciones:lista' %}?f=no_leidas">
      No leídas <span class="badge text-bg-primary">{{ sin_leer }}</span>
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link {% if filtro == 'leidas' %}active{% endif %}"
      href="{% url 'notificaciones:lista' %}?f=leidas">
      Leídas <span class="badge text-bg-success">{{ leidas }}</span>
      </a>
    </li>
  </ul>
</div>

<div class="notif-batch-actions">
<form method="post" action="{% url 'notificaciones:marcar_todo_leido' %}">
 {% csrf_token %}
 <input type="hidden" name="next" value="{{ request.get_full_path }}">
 <button class="btn btn-outline-success btn-sm" type="submit">Marcar todo como leído</button>
</form>
<form method="post" action="{% url 'notificaciones:marcar_todo_no_leido' %}">
 {% csrf_token %}
 <input type="hidden" name="next" value="{{ request.get_full_path }}">
 <button class="btn btn-outline-secondary btn-sm" type="submit">Marcar todo como no leído</button>
 </form>
</div>

<div class="notif-list-wrapper">
{% if notificaciones %}
 <ul class="list-group">
 {% for n in notificaciones %}
 <li class="list-group-item notif-item {% if n.no_leido %}is-unread{% endif %} d-flex justify-content-between align-items-start">
 
 <div class="notif-content me-3">
 <div class="notif-verb">{{ n.verbo }}</div>
 {% if n.target %}
 <small class="notif-meta d-block">Objeto: {{ n.target }}</small>
 {% endif %}
 <small class="notif-meta">{{ n.timestamp|date:"d/m/Y H:i" }}</small>
 </div>

 <div class="notif-actions d-flex align-items-center">
 {# Botón de marcar leído / no leído (con iconos SVG) #}
 {% if n.no_leido %}
 <form method="post" action="{% url 'notificaciones:marcar_leida' n.pk %}">
 {% csrf_token %}
<input type="hidden" name="next" value="{{ request.get_full_path }}">
<button class="btn btn-sm btn-outline-success btn-toggle-read" type="submit" title="Marcar como leído">
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-envelope-fill" viewBox="0 0 16 16">
  <path d="M.05 3.555A2 2 0 0 1 2 2h12a2 2 0 0 1 1.95 1.555L8 8.414zM0 4.697v7.104l5.803-3.558zM6.761 8.83l-6.57 4.027A2 2 0 0 0 2 14h12a2 2 0 0 0 1.808-1.144l-6.57-4.027L8 9.586zm3.436-.586L16 11.801V4.697z"/>
</svg>
 </form>
 {% else %}
<form method="post" action="{% url 'notificaciones:marcar_no_leida' n.pk %}">
 {% csrf_token %}
<input type="hidden" name="next" value="{{ request.get_full_path }}">
 <button class="btn btn-sm btn-outline-secondary btn-toggle-read" type="submit" title="Marcar como no leído">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-envelope-open-fill" viewBox="0 0 16 16">
  <path d="M8.941.435a2 2 0 0 0-1.882 0l-6 3.2A2 2 0 0 0 0 5.4v.314l6.709 3.932L8 8.928l1.291.718L16 5.714V5.4a2 2 0 0 0-1.059-1.765zM16 6.873l-5.693 3.337L16 13.372v-6.5Zm-.059 7.611L8 10.072.059 14.484A2 2 0 0 0 2 16h12a2 2 0 0 0 1.941-1.516M0 13.373l5.693-3.163L0 6.873z"/>
</svg>
                </button>
 </form>
 {% endif %}
 </div>
 </li>
 {% endfor %}
 </ul>
{% else %}
 <div class="text-center p-5 text-muted">
 No tienes notificaciones.
 </div>
 {% endif %}
</div>
{% endblock %}