{% extends 'base.html' %}
{% load static %}

{% block title %}Detalles plantas{% endblock %}

{% block content %}

    <h1>Hola, estás en la página para ver el detalle de un árbol.</h1>

    <form method="get" id="filtrosForm">
    <div>
        <label>Búsqueda por nombre</label>
        <input type="text" name="q" value="{{ q }}" placeholder="Nombre común / científico" id="buscarInput">
    </div>
    <div>
        <label>Fecha desde</label>
        <input type="date" name="fecha_desde" value="{{ fecha_desde }}">
    </div>
    <div>
        <label>Fecha hasta</label>
        <input type="date" name="fecha_hasta" value="{{ fecha_hasta }}">
    </div>
    <div>
        <button type="submit">Filtrar</button>
        <a href="{% url 'planta_inicio' %}">Limpiar</a>
    </div>
    </form>

    <p class="text-muted mb-2">Resultados: {{ total }}</p>
    
    <table class="table">
        <thead>
            <tr>
                <th>Nombre Común</th>
                <th>Nombre Científico</th>
                <th>Descripción</th>
                <th>Fecha de Plantación</th>
                <th>Imagen representativa</th>
                <th>Periocidad de Riego</th>
                <th>Periocidad de Poda</th>
                <th>Periocidad de Fumigacion</th>
                <th>Ubicación (Latitud y Longitud)</th>
                {% if request.user.rol == 'administrador' or request.user.rol == 'gestor' %}
                    <th>Acciones</th>
                {% endif %}
            </tr>
        </thead>
        <tbody>
            {% for p in plantas %}
                <tr>
                    <td>{{ p.nombre_comun }}</td>
                    <td>{{ p.nombre_cientifico }}</td>
                    <td>{{ p.descripcion }}</td>
                    <td>{{ p.fecha_plantacion }}</td>
                    <td>
                        {% if p.imagen_url %}
                            <img src="{{ p.imagen_url.url }}" alt="" style="height:64px; width:auto;">
                        {% else %}
                            —
                        {% endif %}
                    </td>
                    <td>{{ p.periodicidad_riego}}</td>
                    <td>{{ p.periodicidad_poda}}</td>
                    <td>{{ p.periodicidad_fumigacion}}</td>
                    <td>{{ p.lat}}, {{ p.lng }}</td>
                    {% if request.user.rol == 'administrador' or request.user.rol == 'gestor' %}
                        <td>
                            <a href="{% url 'planta_editar' p.id_planta %}" class="btn btn-primary">Editar</a>
                            <a href="{% url 'planta_eliminar' p.id_planta %}" class="btn btn-primary">Eliminar</a>
                        </td>
                    {% endif %}
                </tr>
            {% endfor %}
        </tbody>
    </table>

    {% if request.user.rol == 'administrador' or request.user.rol == 'gestor' %}
        <br><h2>Crear arbol</h2>
        <a href="{% url 'planta_crear' %}" class="btn btn-primary">Crear</a>
    {% endif %}

    {{ maps.map|safe }}

    <script src="{% static 'js/filtros.js' %}"></script>
        
{% endblock %} 